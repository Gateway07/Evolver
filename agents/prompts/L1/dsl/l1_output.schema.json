{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.local/schemas/l1_output.schema.json",
  "title": "OpenEvolve L1 Output Envelope",
  "type": "object",
  "additionalProperties": false,
  "required": ["schema_version", "iteration", "experiment", "theory", "signature_report", "evaluator_runs", "ci_report", "db_manifest"],
  "properties": {
    "schema_version": { "type": "string", "pattern": "^[0-9]+\\.[0-9]+$" },
    "iteration": {
      "type": "object",
      "additionalProperties": false,
      "required": ["id", "timestamp_utc", "locale"],
      "properties": {
        "id": { "type": "string", "minLength": 1, "maxLength": 128 },
        "timestamp_utc": { "type": "string", "format": "date-time" },
        "locale": { "type": "string", "minLength": 1, "maxLength": 64 },
        "prompt_ref": { "type": "string", "maxLength": 512 },
        "notes": { "type": "string", "maxLength": 20000 }
      }
    },
    "experiment": {
      "type": "object",
      "additionalProperties": false,
      "required": ["hypotheses", "group_catalog", "tracing_session"],
      "properties": {
        "hypotheses": {
          "type": "array",
          "minItems": 1,
          "maxItems": 64,
          "items": { "$ref": "hypothesis.schema.json" }
        },
        "group_catalog": {
          "type": "array",
          "minItems": 1,
          "maxItems": 256,
          "items": { "$ref": "group_definition.schema.json" }
        },
        "tracing_session": {
          "description": "Tracing sessions; mandatory when tracing is used.",
          "$ref": "tracing_session.schema.json"
        }
      }
    },
    "theory": {
      "type": "object",
      "additionalProperties": false,
      "required": ["theories"],
      "properties": {
        "theories": {
          "type": "array",
          "minItems": 1,
          "maxItems": 16,
          "items": { "$ref": "theory.schema.json" }
        }
      }
    },
    "signature_report": { "$ref": "signature_report.schema.json" },
    "evaluator_runs": {
      "type": "array",
      "minItems": 1,
      "maxItems": 100000,
      "items": { "$ref": "evaluator_run.schema.json" }
    },
    "ci_report": { "$ref": "ci_report.schema.json" },
    "db_manifest": { "$ref": "db_manifest.schema.json" }
  }
}
