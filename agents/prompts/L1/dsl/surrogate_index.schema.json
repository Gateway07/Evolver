{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.local/schemas/surrogate_index.schema.json",
  "title": "Surrogate Index Build (Mandatory)",
  "type": "object",
  "additionalProperties": false,
  "required": ["ladder_level", "theory_schema_name", "objects_used", "invariants", "build_budget"],
  "properties": {
    "ladder_level": { "type": "string", "enum": ["L1", "L2", "L3", "L4"] },
    "theory_schema_name": { "type": "string", "minLength": 1, "maxLength": 128 },
    "objects_used": {
      "type": "array",
      "minItems": 1,
      "maxItems": 256,
      "items": { "type": "string", "maxLength": 128 }
    },
    "invariants": {
      "type": "array",
      "minItems": 1,
      "maxItems": 128,
      "items": { "type": "string", "maxLength": 4000 }
    },
    "build_budget": {
      "type": "object",
      "additionalProperties": false,
      "required": ["max_objects", "max_materialized_views"],
      "properties": {
        "max_objects": { "type": "integer", "minimum": 1, "maximum": 1000 },
        "max_materialized_views": { "type": "integer", "minimum": 0, "maximum": 50 },
        "notes": { "type": "string", "maxLength": 2000 }
      }
    },
    "performance_evidence": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "expensive_queries": { "type": "array", "items": { "type": "string", "maxLength": 20000 }, "maxItems": 32 },
        "explain_refs": { "type": "array", "items": { "type": "string", "maxLength": 512 }, "maxItems": 32 }
      }
    }
  }
}
